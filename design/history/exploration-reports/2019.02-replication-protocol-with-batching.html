<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>IPLD Specifications</title>
    <meta name="generator" content="VuePress 1.5.4">
    
    <meta name="description" content="Specifications for the Inter-planetary Linked Data project">
    <link rel="preload" href="/assets/css/0.styles.af5e56d4.css" as="style"><link rel="preload" href="/assets/js/app.53df45a9.js" as="script"><link rel="preload" href="/assets/js/2.2d6107ed.js" as="script"><link rel="preload" href="/assets/js/43.92d2c0b4.js" as="script"><link rel="prefetch" href="/assets/js/10.36f99d26.js"><link rel="prefetch" href="/assets/js/11.59f24366.js"><link rel="prefetch" href="/assets/js/12.c1d7df4d.js"><link rel="prefetch" href="/assets/js/13.c86d54ed.js"><link rel="prefetch" href="/assets/js/14.936a4978.js"><link rel="prefetch" href="/assets/js/15.f2f7624c.js"><link rel="prefetch" href="/assets/js/16.72c6b045.js"><link rel="prefetch" href="/assets/js/17.334391e0.js"><link rel="prefetch" href="/assets/js/18.57eddb4e.js"><link rel="prefetch" href="/assets/js/19.3d6009ae.js"><link rel="prefetch" href="/assets/js/20.0faf3a84.js"><link rel="prefetch" href="/assets/js/21.8e6a9f15.js"><link rel="prefetch" href="/assets/js/22.8198c0e0.js"><link rel="prefetch" href="/assets/js/23.2aaf4ccf.js"><link rel="prefetch" href="/assets/js/24.84d126d9.js"><link rel="prefetch" href="/assets/js/25.516272a1.js"><link rel="prefetch" href="/assets/js/26.3048fe76.js"><link rel="prefetch" href="/assets/js/27.8490af3a.js"><link rel="prefetch" href="/assets/js/28.35c5c53b.js"><link rel="prefetch" href="/assets/js/29.7b73ccd3.js"><link rel="prefetch" href="/assets/js/3.97caf465.js"><link rel="prefetch" href="/assets/js/30.88e958bd.js"><link rel="prefetch" href="/assets/js/31.907c62f5.js"><link rel="prefetch" href="/assets/js/32.ffe7ef00.js"><link rel="prefetch" href="/assets/js/33.b40a76c1.js"><link rel="prefetch" href="/assets/js/34.0413fe3b.js"><link rel="prefetch" href="/assets/js/35.e44b1f90.js"><link rel="prefetch" href="/assets/js/36.d6a0c20b.js"><link rel="prefetch" href="/assets/js/37.9c344d0c.js"><link rel="prefetch" href="/assets/js/38.6d0df0c9.js"><link rel="prefetch" href="/assets/js/39.a0a46695.js"><link rel="prefetch" href="/assets/js/4.90771c25.js"><link rel="prefetch" href="/assets/js/40.cd0be5fe.js"><link rel="prefetch" href="/assets/js/41.e4a5d0d3.js"><link rel="prefetch" href="/assets/js/42.8774418c.js"><link rel="prefetch" href="/assets/js/44.e7558d91.js"><link rel="prefetch" href="/assets/js/45.35adffbf.js"><link rel="prefetch" href="/assets/js/46.12e4f96b.js"><link rel="prefetch" href="/assets/js/47.3c4d415e.js"><link rel="prefetch" href="/assets/js/48.49b17ed3.js"><link rel="prefetch" href="/assets/js/49.f5c65001.js"><link rel="prefetch" href="/assets/js/5.72903eba.js"><link rel="prefetch" href="/assets/js/50.8395b13e.js"><link rel="prefetch" href="/assets/js/51.6b1adbc2.js"><link rel="prefetch" href="/assets/js/52.07508add.js"><link rel="prefetch" href="/assets/js/53.b23d88ed.js"><link rel="prefetch" href="/assets/js/54.71287e26.js"><link rel="prefetch" href="/assets/js/55.b7e2be3b.js"><link rel="prefetch" href="/assets/js/56.ea58ec31.js"><link rel="prefetch" href="/assets/js/57.fd82fcf4.js"><link rel="prefetch" href="/assets/js/58.92d0aadd.js"><link rel="prefetch" href="/assets/js/59.a1eb250f.js"><link rel="prefetch" href="/assets/js/6.d29fd7af.js"><link rel="prefetch" href="/assets/js/60.d63eb9a5.js"><link rel="prefetch" href="/assets/js/61.417b32b0.js"><link rel="prefetch" href="/assets/js/62.8901308b.js"><link rel="prefetch" href="/assets/js/63.a4e562a5.js"><link rel="prefetch" href="/assets/js/64.bd4862d6.js"><link rel="prefetch" href="/assets/js/65.548385bf.js"><link rel="prefetch" href="/assets/js/66.5343fd59.js"><link rel="prefetch" href="/assets/js/67.6775bdf5.js"><link rel="prefetch" href="/assets/js/68.ca91ea4d.js"><link rel="prefetch" href="/assets/js/69.ee30823a.js"><link rel="prefetch" href="/assets/js/7.aac06655.js"><link rel="prefetch" href="/assets/js/70.930aa1b5.js"><link rel="prefetch" href="/assets/js/71.c6ce3eaf.js"><link rel="prefetch" href="/assets/js/72.7bfe125b.js"><link rel="prefetch" href="/assets/js/73.0810f010.js"><link rel="prefetch" href="/assets/js/74.b0c24f84.js"><link rel="prefetch" href="/assets/js/75.5794fe7c.js"><link rel="prefetch" href="/assets/js/76.73bbab1d.js"><link rel="prefetch" href="/assets/js/77.07b723ed.js"><link rel="prefetch" href="/assets/js/78.0f605e44.js"><link rel="prefetch" href="/assets/js/79.2adb0a74.js"><link rel="prefetch" href="/assets/js/8.623a5dd0.js"><link rel="prefetch" href="/assets/js/80.00008d60.js"><link rel="prefetch" href="/assets/js/81.9a645944.js"><link rel="prefetch" href="/assets/js/9.05249855.js">
    <link rel="stylesheet" href="/assets/css/0.styles.af5e56d4.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">IPLD Specifications</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/schemas/" class="nav-link">
  IPLD Schemas
</a></div> <a href="https://github.com/ipld/specs" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/schemas/" class="nav-link">
  IPLD Schemas
</a></div> <a href="https://github.com/ipld/specs" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span></span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/design/history/exploration-reports/2019.02-replication-protocol-with-batching.html#current-graphsync-wire-protocol" class="sidebar-link">Current Graphsync wire protocol</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/design/history/exploration-reports/2019.02-replication-protocol-with-batching.html#building-on-top-of-libp2p" class="sidebar-link">Building on top of libp2p</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/design/history/exploration-reports/2019.02-replication-protocol-with-batching.html#batching-responses-of-a-single-request" class="sidebar-link">Batching responses of a single request</a></li><li class="sidebar-sub-header"><a href="/design/history/exploration-reports/2019.02-replication-protocol-with-batching.html#de-duplicating-blocks" class="sidebar-link">De-duplicating blocks</a></li></ul></li><li><a href="/design/history/exploration-reports/2019.02-replication-protocol-with-batching.html#author" class="sidebar-link">Author</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="a-replication-protocol-with-batching-on-top-of-libp2p-streams"><a href="#a-replication-protocol-with-batching-on-top-of-libp2p-streams" class="header-anchor">#</a> A replication protocol with batching on top of libp2p streams</h1> <p>There were lots of discussions about the <a href="https://github.com/ipld/specs/blob/15f1dae2de3708953d6bb0f117fdc4648854ca16/graphsync/graphsync.md#network-messages" target="_blank" rel="noopener noreferrer">Graphsync wire protocol<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>. Sometimes it wasn't clear on which level we'd like to operate. Should it be a protocol for a lower TCP-like level of networking, or rather higher level built on top of libp2p streams?</p> <p>This led to the main point of the discussion which was about how to implement certain batching mechanisms and whether those should be part of the wire protocol itself or not.</p> <p>I was arguing for keeping the protocol simple and doing those optimizations on a different layer. In the end we decided to bake it directly into the wire protocol.</p> <p>Nonetheless I like to publish the thoughts I had on how it could be implemented on top of libp2p as I spent so much time on it and don't want to see those ideas just fade away into void. Perhaps it's useful for someone else or even future protocols we develop.</p> <h2 id="current-graphsync-wire-protocol"><a href="#current-graphsync-wire-protocol" class="header-anchor">#</a> Current Graphsync wire protocol</h2> <p>The basic idea of the current Graphsync protocol is that you send some request and get multiple blocks back. Multiple responses of multiple requests might be put into a single message. I see two reasons for doing this:</p> <ul><li>Block de-duplication: If several responses contain the same blocks, those can be de-duplicated when sent over the wire.</li> <li>Latency/bandwidth trade-off: If the connection between peers has a high latency, but there's still bandwidth available, you could bundle the responses to make better use of the resources.</li></ul> <h2 id="building-on-top-of-libp2p"><a href="#building-on-top-of-libp2p" class="header-anchor">#</a> Building on top of libp2p</h2> <p>I think it would be a huge win for the libp2p ecosystem if we find a way to build protocol independent batching capabilities on top of libp2p. New protocols would become easier to implement, but there would still be ways to optimize for different scenarios where batching makes sense.</p> <h3 id="batching-responses-of-a-single-request"><a href="#batching-responses-of-a-single-request" class="header-anchor">#</a> Batching responses of a single request</h3> <p>libp2p already supports multiplexing, which simplifies the code on the receiving side a lot. How nice would it be if the protocol specific code would only need to deal with single messages, even if they are sent in batches? The sender side would call a library to create batches, the receiving side then splits them into individual ones. This way the protocol specific code to handle messages would only need to deal with single messages.</p> <h3 id="de-duplicating-blocks"><a href="#de-duplicating-blocks" class="header-anchor">#</a> De-duplicating blocks</h3> <p>De-duplicating blocks is a superset of the &quot;<a href="#batching-responses-of-a-single-request">batching responses of a single request</a>&quot; problem. I could imagine that you would write a protocol specific function for assembling and disassembling batches. The advantage over doing it directly on the protocol level would be that you won't need to deal with the disassembling/de-muxing in detail, but on a more abstract level.</p> <p>This mechanism could also be used for bundling several responses in one message.</p> <h2 id="author"><a href="#author" class="header-anchor">#</a> Author</h2> <p>@vmx (Volker Mische)</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/ipld/specs/edit/master/design/history/exploration-reports/2019.02-replication-protocol-with-batching.md" target="_blank" rel="noopener noreferrer">Edit this page on GitHub</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">9/17/2020, 9:15:39 PM</span></div></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.53df45a9.js" defer></script><script src="/assets/js/2.2d6107ed.js" defer></script><script src="/assets/js/43.92d2c0b4.js" defer></script>
  </body>
</html>
