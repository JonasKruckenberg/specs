<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>IPLD Specifications</title>
    <meta name="generator" content="VuePress 1.7.1">
    
    <meta name="description" content="Specifications for the Inter-planetary Linked Data project">
    
    <link rel="preload" href="/assets/css/0.styles.6c77b833.css" as="style"><link rel="preload" href="/assets/js/app.757094d0.js" as="script"><link rel="preload" href="/assets/js/2.fa483b33.js" as="script"><link rel="preload" href="/assets/js/40.a00c141a.js" as="script"><link rel="prefetch" href="/assets/js/10.f6e8966c.js"><link rel="prefetch" href="/assets/js/11.b50c9801.js"><link rel="prefetch" href="/assets/js/12.dfda07e3.js"><link rel="prefetch" href="/assets/js/13.bc44e0a1.js"><link rel="prefetch" href="/assets/js/14.02bd3716.js"><link rel="prefetch" href="/assets/js/15.feedc362.js"><link rel="prefetch" href="/assets/js/16.1076ecbb.js"><link rel="prefetch" href="/assets/js/17.e8d86225.js"><link rel="prefetch" href="/assets/js/18.432bc809.js"><link rel="prefetch" href="/assets/js/19.827517a3.js"><link rel="prefetch" href="/assets/js/20.107dd562.js"><link rel="prefetch" href="/assets/js/21.9682478a.js"><link rel="prefetch" href="/assets/js/22.16c1dfa6.js"><link rel="prefetch" href="/assets/js/23.73b5da36.js"><link rel="prefetch" href="/assets/js/24.3b49ec67.js"><link rel="prefetch" href="/assets/js/25.82ea8731.js"><link rel="prefetch" href="/assets/js/26.8d839a4f.js"><link rel="prefetch" href="/assets/js/27.9ae3b661.js"><link rel="prefetch" href="/assets/js/28.fcd5d716.js"><link rel="prefetch" href="/assets/js/29.20740a44.js"><link rel="prefetch" href="/assets/js/3.ec93e3b4.js"><link rel="prefetch" href="/assets/js/30.ca7982f3.js"><link rel="prefetch" href="/assets/js/31.ae2ce766.js"><link rel="prefetch" href="/assets/js/32.7d485198.js"><link rel="prefetch" href="/assets/js/33.b613ada2.js"><link rel="prefetch" href="/assets/js/34.de059188.js"><link rel="prefetch" href="/assets/js/35.d54f4786.js"><link rel="prefetch" href="/assets/js/36.b333855f.js"><link rel="prefetch" href="/assets/js/37.98cdb5f1.js"><link rel="prefetch" href="/assets/js/38.b9efb2a6.js"><link rel="prefetch" href="/assets/js/39.17851f81.js"><link rel="prefetch" href="/assets/js/4.84d7103d.js"><link rel="prefetch" href="/assets/js/41.5094b89d.js"><link rel="prefetch" href="/assets/js/42.ec98dfe9.js"><link rel="prefetch" href="/assets/js/43.2ee6e9a8.js"><link rel="prefetch" href="/assets/js/44.65a576ea.js"><link rel="prefetch" href="/assets/js/45.593a52a5.js"><link rel="prefetch" href="/assets/js/46.bcb79bdb.js"><link rel="prefetch" href="/assets/js/47.a4432f9d.js"><link rel="prefetch" href="/assets/js/48.da38e5b0.js"><link rel="prefetch" href="/assets/js/49.fa55d480.js"><link rel="prefetch" href="/assets/js/5.abf32d94.js"><link rel="prefetch" href="/assets/js/50.16577106.js"><link rel="prefetch" href="/assets/js/51.2c1adf3b.js"><link rel="prefetch" href="/assets/js/52.868e1adf.js"><link rel="prefetch" href="/assets/js/53.6438cdd9.js"><link rel="prefetch" href="/assets/js/54.4abe395d.js"><link rel="prefetch" href="/assets/js/55.18e8e5e8.js"><link rel="prefetch" href="/assets/js/56.d6796985.js"><link rel="prefetch" href="/assets/js/57.05dcf116.js"><link rel="prefetch" href="/assets/js/58.f770c881.js"><link rel="prefetch" href="/assets/js/59.fa7ec79a.js"><link rel="prefetch" href="/assets/js/6.ae3a0372.js"><link rel="prefetch" href="/assets/js/60.e063ccc7.js"><link rel="prefetch" href="/assets/js/61.452286d3.js"><link rel="prefetch" href="/assets/js/62.2c538e75.js"><link rel="prefetch" href="/assets/js/63.cba921cf.js"><link rel="prefetch" href="/assets/js/64.9b9dac6f.js"><link rel="prefetch" href="/assets/js/65.ec5e0052.js"><link rel="prefetch" href="/assets/js/66.e9e432e3.js"><link rel="prefetch" href="/assets/js/67.e9a74401.js"><link rel="prefetch" href="/assets/js/68.dffab38a.js"><link rel="prefetch" href="/assets/js/69.47e3973b.js"><link rel="prefetch" href="/assets/js/7.263efb07.js"><link rel="prefetch" href="/assets/js/70.42920213.js"><link rel="prefetch" href="/assets/js/71.7e25a07e.js"><link rel="prefetch" href="/assets/js/72.7062fa78.js"><link rel="prefetch" href="/assets/js/73.c615943f.js"><link rel="prefetch" href="/assets/js/74.d2129217.js"><link rel="prefetch" href="/assets/js/75.ea255353.js"><link rel="prefetch" href="/assets/js/76.b1ae39e7.js"><link rel="prefetch" href="/assets/js/77.4731ca12.js"><link rel="prefetch" href="/assets/js/78.a75c2929.js"><link rel="prefetch" href="/assets/js/79.8035730e.js"><link rel="prefetch" href="/assets/js/8.6b02f076.js"><link rel="prefetch" href="/assets/js/80.0b1f1b5d.js"><link rel="prefetch" href="/assets/js/81.631c2a05.js"><link rel="prefetch" href="/assets/js/82.02ff783b.js"><link rel="prefetch" href="/assets/js/83.b6161b18.js"><link rel="prefetch" href="/assets/js/84.2d55bac9.js"><link rel="prefetch" href="/assets/js/85.17ff4350.js"><link rel="prefetch" href="/assets/js/86.07592a54.js"><link rel="prefetch" href="/assets/js/87.7302f8de.js"><link rel="prefetch" href="/assets/js/88.52b086d4.js"><link rel="prefetch" href="/assets/js/89.40e0f606.js"><link rel="prefetch" href="/assets/js/9.4dd99b27.js">
    <link rel="stylesheet" href="/assets/css/0.styles.6c77b833.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">IPLD Specifications</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/schemas/" class="nav-link">
  IPLD Schemas
</a></div> <a href="https://github.com/ipld/specs" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/schemas/" class="nav-link">
  IPLD Schemas
</a></div> <a href="https://github.com/ipld/specs" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span></span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/design/history/exploration-reports/2018.07-merkle-segments.html#mission" class="sidebar-link">Mission</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/design/history/exploration-reports/2018.07-merkle-segments.html#why" class="sidebar-link">Why</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/design/history/exploration-reports/2018.07-merkle-segments.html#mission-refined" class="sidebar-link">Mission, refined</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/design/history/exploration-reports/2018.07-merkle-segments.html#progress" class="sidebar-link">Progress</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><p>This document was archived from https://github.com/ipld/specs/issues/67. There was agreement that UTF-8 NFC should be the canonical encoding. Below is the original text of the issue written by @warpfork.</p> <hr> <h2 id="mission"><a href="#mission" class="header-anchor">#</a> Mission</h2> <p>It's important to specify precisely what is a valid merklepath segement in IPLD.</p> <p>The spec currently contains a &quot;TODO: list path resolving restrictions&quot; and this could be improved ðŸ˜ƒ</p> <hr> <h2 id="why"><a href="#why" class="header-anchor">#</a> Why</h2> <p>First, a quick clarification: &quot;merklepath segments&quot; are a distinct concept from &quot;IPLD Selectors&quot;.  Merklepaths are a specific and limited implementation of IPLD Selectors; they can only specify a traversal to a single object; and importantly, we want them to be serializable in a way that's easy for humans to operate.  To quote the current spec for motivations:</p> <blockquote><p>IPLD paths MUST layer cleanly over UNIX and The Web (use <code>/</code>, have deterministic transforms for ASCII systems).</p></blockquote> <p>(Perhaps &quot;ASCII&quot; is a little over-constrained there.  The spec <em>also</em> says &quot;
IPLD paths MUST be universal and avoid oppressing non-english societies (e.g. use UTF-8, not ASCII)&quot; -- we might want to refine those two lines after we tackle the rest of this issue.)</p> <p>Second of all, just a <em>list</em> of other issues that are fairly closely related to a need for clarity on this subject:</p> <ul><li>https://github.com/ipfs/go-ipfs/issues/1710 -- &quot;<strong>IPFS permits undesirable paths</strong>&quot; -- lots of good discussion on encodings, and examples of valid but problematic characters</li> <li>https://github.com/ipld/specs/issues/59 -- &quot;<strong>Document restrictions on keys of maps</strong>&quot;</li> <li>https://github.com/ipld/specs/issues/58 -- &quot;<strong>Non-string keys</strong>&quot; -- this one has a particularly interesting detail quoted: &quot;The original intention was to actually be quite restrictive: map keys must be unicode strings with no slashes. However, we've loosened that so that they can contain slashes, it's just that those keys can't be pathed through.&quot;.  (n.b. <em>this</em> issue here is named &quot;merklepath segments&quot;, not &quot;IPLD keys&quot;, specifically to note this same distinction.)</li> <li>https://github.com/ipld/specs/issues/55 -- &quot;<strong>Spec out DagPB path resolution</strong>&quot;</li> <li>https://github.com/ipld/specs/issues/37 -- &quot;<strong>Spec refining: make sure that an attribute cannot be named <code>.</code></strong>&quot;</li> <li>https://github.com/ipld/specs/issues/20 -- &quot;<strong>Spec refining: Merkle-paths to an array's index</strong>&quot;</li> <li>https://github.com/ipld/specs/issues/15 -- &quot;<strong>Spec refining: Terminology IPLD vs Merkle</strong>&quot; -- basically, am I titling this issue correctly by saying &quot;merklepath&quot;?  Perhaps not ðŸ˜‰</li> <li>https://github.com/ipld/specs/issues/1 -- &quot;<strong>Spec refining: Relative paths in IPLD</strong>&quot; -- may require reserving more character sequences as special</li> <li>https://github.com/ipfs/unixfs-v2/issues/3 -- &quot;<strong>Handing of non-utf-8 posix filenames</strong>&quot;</li> <li>https://github.com/ipfs/go-ipfs/issues/4292 -- &quot;<strong>WebUI should (somehow) indicate a problematic directory entry</strong>&quot;</li> <li>perhaps more!</li></ul> <p>As this list makes evident... we really need to get this nailed down.</p> <hr> <h2 id="mission-refined"><a href="#mission-refined" class="header-anchor">#</a> Mission, refined</h2> <p>Okay, motivations and intro done.  What do we need to <em>do</em>?</p> <p>(1) Update the spec to be consistently clear about IPLD <em>keys</em> versus <em>valid merklepath segments</em>.  This distinction seems to exist already, but it's tricky, so we should hammer it.</p> <p>(2) Define normal character encoding.  (I think it's now well established that this is necessary -- merklepath segments are <em>absolutely</em> for direct human use, so we're certainly speaking of chars rather than bytes; and also unicode is complex and ignoring normalization is not viable.)</p> <p>(3) Define any blacklisting of any further byte sequences which are valid normalized characters but we nonetheless don't want to see in merklepath segments.</p> <p>(4) Ensure we're clear about what happens when an IPLD key is valid but as a key but not a merklepath segment (e.g. it's unpathable).</p> <p>(And one more quick note: a lot of this has been in discussion already as part of sussing out the unixfsv2 spec.  In unixfsv2, we've come to the conclusion that some of our path handling rules are quantum-entangled with the IPLD spec for merklepaths.  Unixfsv2 may apply <em>more</em> blacklistings of byte sequences which are problematic than IPLD merklepath segements, so we don't have to worry about <em>everything</em> up here; but we do want to spec this <em>first</em>, so we can make sure the Unixfsv2 behavior normalizers are a nice subset of the IPLD merklepath rules.)</p> <hr> <h2 id="progress"><a href="#progress" class="header-anchor">#</a> Progress</h2> <p><strong>Regarding (1)</strong>: &quot;just a small matter of writing&quot; once we nail the rest...</p> <p><strong>Regarding (2)</strong>: <strong>We have an answer <a href="https://www.unicode.org/reports/tr15/#Norm_Forms" target="_blank" rel="noopener noreferrer">and the answer is &quot;NFC&quot;<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></strong>.  (At least, I think we have an answer with reasonable consensus.)  We had a long thread about this <a href="https://github.com/ipfs/unixfs-v2/issues/3" target="_blank" rel="noopener noreferrer">in the context of unixfsv2<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, but entirely applicable here in general.  Everyone seems to agree that UTF8 is a sensible place to be and <a href="https://github.com/ipfs/unixfs-v2/issues/3#issuecomment-404760564" target="_blank" rel="noopener noreferrer">NFC encoding is a sensible, already-well-specified normalization<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> to use.  And importantly, in practice, NFC is the encoding seen in practically all documents everywhere, so choosing NFC means we accept the majority of strings unchanged.  Whew. <em>dusts off hands</em></p> <p><strong>Regarding (3)</strong>: Lots of example choices in https://github.com/ipfs/go-ipfs/issues/1710 .  We need to reify that into a list in the spec.</p> <p><strong>Regarding (4)</strong>: Open field?</p> <p>(I'll update this &quot;progress&quot; section as discussion... progresses.)</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/ipld/specs/edit/master/design/history/exploration-reports/2018.07-merkle-segments.md" target="_blank" rel="noopener noreferrer">Edit this page on GitHub</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">11/13/2020, 12:55:51 AM</span></div></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.757094d0.js" defer></script><script src="/assets/js/2.fa483b33.js" defer></script><script src="/assets/js/40.a00c141a.js" defer></script>
  </body>
</html>
