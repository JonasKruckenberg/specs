<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>IPLD Specifications</title>
    <meta name="generator" content="VuePress 1.7.1">
    
    <meta name="description" content="Specifications for the Inter-planetary Linked Data project">
    
    <link rel="preload" href="/assets/css/0.styles.6c77b833.css" as="style"><link rel="preload" href="/assets/js/app.dd7273d4.js" as="script"><link rel="preload" href="/assets/js/2.fa483b33.js" as="script"><link rel="preload" href="/assets/js/59.d5953986.js" as="script"><link rel="prefetch" href="/assets/js/10.f6e8966c.js"><link rel="prefetch" href="/assets/js/11.b50c9801.js"><link rel="prefetch" href="/assets/js/12.dfda07e3.js"><link rel="prefetch" href="/assets/js/13.bc44e0a1.js"><link rel="prefetch" href="/assets/js/14.02bd3716.js"><link rel="prefetch" href="/assets/js/15.feedc362.js"><link rel="prefetch" href="/assets/js/16.1076ecbb.js"><link rel="prefetch" href="/assets/js/17.83c7ad87.js"><link rel="prefetch" href="/assets/js/18.fb0a53fa.js"><link rel="prefetch" href="/assets/js/19.6cad2206.js"><link rel="prefetch" href="/assets/js/20.e5d2b50d.js"><link rel="prefetch" href="/assets/js/21.7255bc0c.js"><link rel="prefetch" href="/assets/js/22.61d63bb5.js"><link rel="prefetch" href="/assets/js/23.20e9e9e8.js"><link rel="prefetch" href="/assets/js/24.c35c7061.js"><link rel="prefetch" href="/assets/js/25.02f56933.js"><link rel="prefetch" href="/assets/js/26.9763295a.js"><link rel="prefetch" href="/assets/js/27.d40bd431.js"><link rel="prefetch" href="/assets/js/28.666891d7.js"><link rel="prefetch" href="/assets/js/29.2196a2d1.js"><link rel="prefetch" href="/assets/js/3.ce55762f.js"><link rel="prefetch" href="/assets/js/30.806aa330.js"><link rel="prefetch" href="/assets/js/31.a448c6a4.js"><link rel="prefetch" href="/assets/js/32.0658f00c.js"><link rel="prefetch" href="/assets/js/33.6e36c0be.js"><link rel="prefetch" href="/assets/js/34.fc297eec.js"><link rel="prefetch" href="/assets/js/35.67518866.js"><link rel="prefetch" href="/assets/js/36.477e2ecf.js"><link rel="prefetch" href="/assets/js/37.5a63d481.js"><link rel="prefetch" href="/assets/js/38.e9896ca1.js"><link rel="prefetch" href="/assets/js/39.c023f51e.js"><link rel="prefetch" href="/assets/js/4.84d7103d.js"><link rel="prefetch" href="/assets/js/40.543eab40.js"><link rel="prefetch" href="/assets/js/41.c97acf8b.js"><link rel="prefetch" href="/assets/js/42.0c297929.js"><link rel="prefetch" href="/assets/js/43.24f355f4.js"><link rel="prefetch" href="/assets/js/44.be6f4b64.js"><link rel="prefetch" href="/assets/js/45.5616e444.js"><link rel="prefetch" href="/assets/js/46.178cd27a.js"><link rel="prefetch" href="/assets/js/47.931d1ebf.js"><link rel="prefetch" href="/assets/js/48.e718b233.js"><link rel="prefetch" href="/assets/js/49.6ee87e40.js"><link rel="prefetch" href="/assets/js/5.abf32d94.js"><link rel="prefetch" href="/assets/js/50.bd3c41d0.js"><link rel="prefetch" href="/assets/js/51.6b34c736.js"><link rel="prefetch" href="/assets/js/52.a71ac794.js"><link rel="prefetch" href="/assets/js/53.22cfe720.js"><link rel="prefetch" href="/assets/js/54.f191b562.js"><link rel="prefetch" href="/assets/js/55.ad506e80.js"><link rel="prefetch" href="/assets/js/56.d371d416.js"><link rel="prefetch" href="/assets/js/57.1a245a79.js"><link rel="prefetch" href="/assets/js/58.f895a993.js"><link rel="prefetch" href="/assets/js/6.8e80b6bb.js"><link rel="prefetch" href="/assets/js/60.faef6b7f.js"><link rel="prefetch" href="/assets/js/61.af720eaa.js"><link rel="prefetch" href="/assets/js/62.84c72a46.js"><link rel="prefetch" href="/assets/js/63.dd894062.js"><link rel="prefetch" href="/assets/js/64.3edc5c3b.js"><link rel="prefetch" href="/assets/js/65.92f0c2f1.js"><link rel="prefetch" href="/assets/js/66.71f337d2.js"><link rel="prefetch" href="/assets/js/67.9d77d778.js"><link rel="prefetch" href="/assets/js/68.8e08e272.js"><link rel="prefetch" href="/assets/js/69.0bca181d.js"><link rel="prefetch" href="/assets/js/7.20765c01.js"><link rel="prefetch" href="/assets/js/70.0d1e90cc.js"><link rel="prefetch" href="/assets/js/71.3c62e64f.js"><link rel="prefetch" href="/assets/js/72.1cc8375e.js"><link rel="prefetch" href="/assets/js/73.4791ebfa.js"><link rel="prefetch" href="/assets/js/74.032ab4ac.js"><link rel="prefetch" href="/assets/js/75.1ea0d30b.js"><link rel="prefetch" href="/assets/js/76.7c0afe1a.js"><link rel="prefetch" href="/assets/js/77.c866cb21.js"><link rel="prefetch" href="/assets/js/78.1ecf418e.js"><link rel="prefetch" href="/assets/js/79.d9f2e81f.js"><link rel="prefetch" href="/assets/js/8.6b02f076.js"><link rel="prefetch" href="/assets/js/80.90ad9f35.js"><link rel="prefetch" href="/assets/js/81.c6dd8988.js"><link rel="prefetch" href="/assets/js/82.2c56d1cd.js"><link rel="prefetch" href="/assets/js/83.ef332e9f.js"><link rel="prefetch" href="/assets/js/84.c31cb174.js"><link rel="prefetch" href="/assets/js/85.6c4554f1.js"><link rel="prefetch" href="/assets/js/86.3e7c685c.js"><link rel="prefetch" href="/assets/js/87.aa391666.js"><link rel="prefetch" href="/assets/js/88.dbb53c4d.js"><link rel="prefetch" href="/assets/js/89.b61fc1a2.js"><link rel="prefetch" href="/assets/js/9.4dd99b27.js"><link rel="prefetch" href="/assets/js/90.dd04f094.js"><link rel="prefetch" href="/assets/js/91.932346e8.js"><link rel="prefetch" href="/assets/js/92.7e4e3238.js"><link rel="prefetch" href="/assets/js/93.9e0b9fc3.js"><link rel="prefetch" href="/assets/js/94.fae6c28d.js"><link rel="prefetch" href="/assets/js/95.1506c4a5.js"><link rel="prefetch" href="/assets/js/96.eac0aa58.js">
    <link rel="stylesheet" href="/assets/css/0.styles.6c77b833.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">IPLD Specifications</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/schemas/" class="nav-link">
  IPLD Schemas
</a></div> <a href="https://github.com/ipld/specs" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/schemas/" class="nav-link">
  IPLD Schemas
</a></div> <a href="https://github.com/ipld/specs" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span></span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/design/history/exploration-reports/2019.09-adl-schema-root-type-defn.html#root-node-type-definitions" class="sidebar-link">Root node type definitions</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="root-type-definitions-for-adl-schema-declarations"><a href="#root-type-definitions-for-adl-schema-declarations" class="header-anchor">#</a> Root type definitions for ADL schema declarations</h1> <p>This text formed an original part of https://github.com/ipld/specs/pull/182 for the file schemas/advanced-layouts.md. The initial proposal included a <code>root</code> type specifier for <code>advanced</code> declarations that would allow the schema parser to make assumptions (and assertions) about the data found at the node where the ADL was encountered.</p> <p>This (partly) necessitated the connection of an ADL implementation schema to an ADL usage schema, such that a user would have to reach into the implementation and refer to a type defined there. For this reason (primarily), <code>root</code> was removed from the proposal and an ADL is to be declared simply with its name, <code>advanced Foo</code>, and no additional information, for now.</p> <hr> <h2 id="root-node-type-definitions"><a href="#root-node-type-definitions" class="header-anchor">#</a> Root node type definitions</h2> <p>Advanced layouts are designed to abstract data that exists at the data model layer. As such, they may also dictate what they expect from the data that exists at the node their <em>root</em> resides at.</p> <p>In the case of our <code>ROT13</code> <code>string</code> representation, we are likely to want to store this on the block as a <code>string</code> (i.e. this is a crude encryption mechanism, transforming <code>string</code> to <code>string</code>—realistic encryption mechanisms are likely to involve <code>bytes</code> and perhaps complex data structures to store encryption metadata).</p> <div class="language-ipldsch extra-class"><pre class="language-ipldsch"><code><span class="token typedef"><span class="token keyword">advanced</span> <span class="token class-name">ROT13</span></span> <span class="token punctuation">{</span>
  root String
<span class="token punctuation">}</span>

<span class="token typedef"><span class="token keyword">type</span> <span class="token class-name">MyString</span></span> <span class="token keyword">string</span> representation ROT13

<span class="token typedef"><span class="token keyword">type</span> <span class="token class-name">Name</span></span> <span class="token builtin">struct</span> <span class="token punctuation">{</span>
  firstname MyString
  surname MyString
<span class="token punctuation">}</span>
</code></pre></div><p>A validator using our schema is now able to assert that it should find a <code>map</code> (default <code>struct</code> representation) with two fields, <code>firstname</code> and <code>surname</code>, and, thanks to the <code>root</code> definition of <code>ROT13</code>, it may also assert that these two fields are of kind <code>string</code>.</p> <p>We may also introduce complex types as the root definition. For example, a <code>byte</code> representation that is a chain of blocks, each containing a section of <code>bytes</code> and a link to the next block:</p> <div class="language-ipldsch extra-class"><pre class="language-ipldsch"><code><span class="token typedef"><span class="token keyword">advanced</span> <span class="token class-name">ChainedBytes</span></span> <span class="token punctuation">{</span>
  root Chunk
<span class="token punctuation">}</span>

<span class="token typedef"><span class="token keyword">type</span> <span class="token class-name">Chunk</span></span> <span class="token builtin">struct</span> <span class="token punctuation">{</span>
  contents Bytes
  next <span class="token keyword">nullable</span> Link
<span class="token punctuation">}</span>
</code></pre></div><p>Or, as in the IPLD <a href="/design/history/data-structures/hashmap.html">HashMap</a> spec:</p> <div class="language-ipldsch extra-class"><pre class="language-ipldsch"><code><span class="token typedef"><span class="token keyword">advanced</span> <span class="token class-name">HashMap</span></span> <span class="token punctuation">{</span>
  root HashMapRoot
<span class="token punctuation">}</span>

<span class="token comment"># Root node layout</span>
<span class="token typedef"><span class="token keyword">type</span> <span class="token class-name">HashMapRoot</span></span> <span class="token builtin">struct</span> <span class="token punctuation">{</span>
  hashAlg String
  bucketSize Int
  map Bytes
  data <span class="token punctuation">[</span> Element <span class="token punctuation">]</span>
<span class="token punctuation">}</span>

<span class="token comment"># ... `Element` (and further) definition omitted</span>
</code></pre></div><p>And we could use this to define a map of <code>string</code>s to <code>link</code>s:</p> <div class="language-ipldsch extra-class"><pre class="language-ipldsch"><code><span class="token typedef"><span class="token keyword">type</span> <span class="token class-name">MyMap</span></span> <span class="token punctuation">{</span> String <span class="token punctuation">:</span> Link <span class="token punctuation">}</span> representation HashMap
</code></pre></div><p>We could even combine usage of our <code>ROT13</code> and <code>HashMap</code> definitions in novel ways:</p> <div class="language-ipldsch extra-class"><pre class="language-ipldsch"><code><span class="token typedef"><span class="token keyword">type</span> <span class="token class-name">BigConfidentialCatalog</span></span> <span class="token punctuation">[</span> Secretz <span class="token punctuation">]</span>

<span class="token typedef"><span class="token keyword">type</span> <span class="token class-name">Secretz</span></span> <span class="token builtin">struct</span> <span class="token punctuation">{</span>
  title MyString
  data MyMap
<span class="token punctuation">}</span>

<span class="token typedef"><span class="token keyword">type</span> <span class="token class-name">MyMap</span></span> <span class="token punctuation">{</span> String <span class="token punctuation">:</span> Name <span class="token punctuation">}</span> representation HashMap
</code></pre></div><p>If we were to take an IPLD node, and assert that it is of type <code>BigConfidentialCatalog</code>, we should expect that:</p> <ol><li>The node is a <code>list</code> kind</li> <li>Each element of the <code>list</code> contains a <code>map</code>, which is described by <code>Secretz</code></li> <li>Each map contains the two properties defined by <code>Secretz</code>: <code>title</code> and <code>data</code></li> <li>The <code>title</code> property of the <code>map</code> is of <code>string</code> kind, thanks to the <code>MyString</code> definition, but it must be transformed through the <code>ROT13</code> layout to make sense of it.</li> <li>The <code>data</code> property of the <code>map</code> is of <code>map</code> kind, which itself should conform to the <code>HashMapRoot</code> type specification, but must be interacted through with the logic associated with <code>HashMap</code> in order to make sense of it (which may also involve loading further blocks to traverse the sharded data).</li></ol> <p>If <code>ROT13</code> and <code>HashMap</code> were to omit their <code>root</code> descriptor, we could only make assertions 1 and 2 above.</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/ipld/specs/edit/master/design/history/exploration-reports/2019.09-adl-schema-root-type-defn.md" target="_blank" rel="noopener noreferrer">Edit this page on GitHub</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">12/1/2020, 12:48:00 PM</span></div></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.dd7273d4.js" defer></script><script src="/assets/js/2.fa483b33.js" defer></script><script src="/assets/js/59.d5953986.js" defer></script>
  </body>
</html>
